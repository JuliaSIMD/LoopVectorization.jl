<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Determining the strategy for evaluating loops · LoopVectorization.jl</title><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.svg" alt="LoopVectorization.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">LoopVectorization.jl</a></span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><a class="tocitem" href="../../getting_started/">Getting Started</a></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../../examples/multithreading/">Multithreading</a></li><li><a class="tocitem" href="../../examples/matrix_multiplication/">Matrix Multiplication</a></li><li><a class="tocitem" href="../../examples/array_interface/">Array Interface</a></li><li><a class="tocitem" href="../../examples/matrix_vector_ops/">Matrix-Vector Operations</a></li><li><a class="tocitem" href="../../examples/dot_product/">Dot Products</a></li><li><a class="tocitem" href="../../examples/datetime_arrays/">Composite Types: DateTime Arrays</a></li><li><a class="tocitem" href="../../examples/special_functions/">Special Functions</a></li><li><a class="tocitem" href="../../examples/sum_of_squared_error/">Sum of squared error</a></li><li><a class="tocitem" href="../../examples/filtering/">Image Filtering</a></li></ul></li><li><a class="tocitem" href="../../vectorized_convenience_functions/">Vectorized Convenience Functions</a></li><li><a class="tocitem" href="../../future_work/">Future Work</a></li><li><a class="tocitem" href="../../api/">API reference</a></li><li><span class="tocitem">Developer Documentation</span><ul><li><a class="tocitem" href="../overview/">Developer Overview</a></li><li><a class="tocitem" href="../loopset_structure/">LoopSet Structure</a></li><li><a class="tocitem" href="../constructing_loopsets/">Constructing LoopSets</a></li><li class="is-active"><a class="tocitem" href>Determining the strategy for evaluating loops</a></li><li><a class="tocitem" href="../lowering/">Lowering</a></li><li><a class="tocitem" href="../reference/">Internals reference</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Developer Documentation</a></li><li class="is-active"><a href>Determining the strategy for evaluating loops</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Determining the strategy for evaluating loops</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/JuliaSIMD/LoopVectorization.jl/blob/main/docs/src/devdocs/evaluating_loops.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Determining-the-strategy-for-evaluating-loops"><a class="docs-heading-anchor" href="#Determining-the-strategy-for-evaluating-loops">Determining the strategy for evaluating loops</a><a id="Determining-the-strategy-for-evaluating-loops-1"></a><a class="docs-heading-anchor-permalink" href="#Determining-the-strategy-for-evaluating-loops" title="Permalink"></a></h1><p>The heart of the optimizations performed by LoopVectorization are given in the <a href="https://github.com/JuliaSIMD/LoopVectorization.jl/blob/master/src/modeling/determinestrategy.jl">determinestrategy.jl</a> file utilizing instruction costs specified in <a href="https://github.com/JuliaSIMD/LoopVectorization.jl/blob/master/src/modeling/costs.jl">costs.jl</a>. Essentially, it estimates the cost of different means of evaluating the loops. It iterates through the different possible loop orders, as well as considering which loops to unroll, and which to vectorize. It will consider unrolling 1 or 2 loops (but it could settle on unrolling by a factor of 1, i.e. not unrolling), and vectorizing 1.</p><p>The cost estimate is based on the costs of individual instructions and the number of times each one needs to be executed for the given strategy. The instruction cost can be broken into several components:</p><ul><li>The <code>scalar latency</code> is the minimum delay, in clock cycles, associated with the instruction. Think of it as the delay from turning on the water to when water starts coming out the hose.</li><li>The <code>reciprocal throughput</code> is similar to the latency, but it measures the number of cycles per operation when many of the same operation are repeated in sequence.  Continuing our hose analogy, think of it as the inverse of the flow rate at steady-state. It is typically ≤ the <code>scalar latency</code>.</li><li>The <code>register pressure</code> measures the register consumption by the operation</li></ul><p>Data on individual instructions for specific architectures can be found on <a href="https://agner.org/optimize/instruction_tables.pdf">Agner Fog&#39;s website</a>. Most of the costs used were those for the Skylake-X architecture.</p><p>Examples of how these come into play:</p><ul><li>Vectorizing a loop will result in each instruction evaluating multiple iterations, but the costs of loads and stores will change based on the memory layouts of the accessed arrays.</li><li>Unrolling can help reduce the number of times an operation must be performed, for example if it can allow us to reuse memory multiple times rather than reloading it every time it is needed.</li><li>When there is a reduction, such as performing a sum, there is a dependency chain. Each <code>+</code> has to wait for the previous <code>+</code> to finish executing before it can begin, thus execution time is bounded by latency rather than the minimum of the throughput of the <code>+</code> and load operations. By unrolling the loop, we can create multiple independent dependency chains.</li></ul></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../constructing_loopsets/">« Constructing LoopSets</a><a class="docs-footer-nextpage" href="../lowering/">Lowering »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.25 on <span class="colophon-date" title="Tuesday 11 July 2023 05:40">Tuesday 11 July 2023</span>. Using Julia version 1.9.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
